{% extends 'base.html' %}
{% load static %}
{% block title %}Customer Reviews - Kinbo Shop{% endblock %}
{% block footer %}{% endblock %}

{% block content %}
<section id="all-reviews" class="max-w-[1320px] mx-auto mt-10 px-4 text-gray-800">

  <!-- ============================= -->
  <!-- 1. Top Navigation Bar -->
  <!-- ============================= -->
  <div class="flex items-center justify-between mb-8">
    <!-- Go Back Button -->
    <button onclick="history.back()" class="flex items-center text-orange-600 hover:text-orange-700 font-medium">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
      Go Back
    </button>

    <!-- Heading -->
    <div class="text-right">
      <h2 class="text-2xl font-semibold">Customer Reviews</h2>
      <p class="text-sm text-gray-500">Showing 20 of 132 reviews • Average rating: 4.5★</p>
    </div>
  </div>

  <!-- ============================= -->
  <!-- 2. Rating Breakdown -->
  <!-- ============================= -->
  <div class="mb-10">
    <h3 class="font-medium mb-4">Rating breakdown</h3>

    <div class="flex items-center mb-2">
      <span class="w-12 text-sm text-gray-600">5★</span>
      <div class="flex-1 h-3 bg-gray-200 rounded-full overflow-hidden">
        <div class="h-full bg-orange-400" style="width: 73%;"></div>
      </div>
      <span class="w-16 text-right text-sm text-gray-600 ml-2">97</span>
    </div>
    <div class="flex items-center mb-2">
      <span class="w-12 text-sm text-gray-600">4★</span>
      <div class="flex-1 h-3 bg-gray-200 rounded-full overflow-hidden">
        <div class="h-full bg-orange-400" style="width: 11%;"></div>
      </div>
      <span class="w-16 text-right text-sm text-gray-600 ml-2">15</span>
    </div>
    <div class="flex items-center mb-2">
      <span class="w-12 text-sm text-gray-600">3★</span>
      <div class="flex-1 h-3 bg-gray-200 rounded-full overflow-hidden">
        <div class="h-full bg-orange-400" style="width: 9%;"></div>
      </div>
      <span class="w-16 text-right text-sm text-gray-600 ml-2">12</span>
    </div>
    <div class="flex items-center mb-2">
      <span class="w-12 text-sm text-gray-600">2★</span>
      <div class="flex-1 h-3 bg-gray-200 rounded-full overflow-hidden">
        <div class="h-full bg-orange-400" style="width: 4%;"></div>
      </div>
      <span class="w-16 text-right text-sm text-gray-600 ml-2">5</span>
    </div>
    <div class="flex items-center">
      <span class="w-12 text-sm text-gray-600">1★</span>
      <div class="flex-1 h-3 bg-gray-200 rounded-full overflow-hidden">
        <div class="h-full bg-orange-400" style="width: 2%;"></div>
      </div>
      <span class="w-16 text-right text-sm text-gray-600 ml-2">3</span>
    </div>
  </div>

  <!-- ============================= -->
  <!-- 3. Review List (20 Reviews) -->
  <!-- ============================= -->
  <div class="space-y-10">
    {% comment %} Duplicate the review structure below 20 times (for now use demo reviews) {% endcomment %}
    {% for i in "1234567891011121314151617181920" %}
    <article class="flex flex-col sm:flex-row sm:space-x-6">
      <img src="{% static 'images/profile.jpg' %}" alt="Profile photo" class="w-16 h-16 rounded-full object-cover mb-4 sm:mb-0">
      <div class="flex-1">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
          <div class="flex items-center space-x-2">
            <span class="font-semibold text-gray-800">Rahim Uddin</span>
            <span class="text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded">Verified Purchase</span>
          </div>
          <span class="text-sm text-gray-500">Nov 3, 2025</span>
        </div>
        <div class="flex space-x-1 mt-1" aria-label="5 out of 5 stars">
          <span class="text-orange-400">★</span><span class="text-orange-400">★</span>
          <span class="text-orange-400">★</span><span class="text-orange-400">★</span>
          <span class="text-orange-400">★</span>
        </div>
        <div class="mt-3 relative">
          <p class="text-gray-700 review-text overflow-hidden transition-all duration-500 ease-in-out">
            Absolutely loved the fabric quality and the stitching. The shirt fits perfectly and feels comfortable in Dhaka’s warm weather.
            The fabric feels premium, doesn’t lose color after wash, and the sleeves hold shape nicely even after multiple wears.
            Highly recommend it for anyone who wants a casual yet elegant look that lasts.
          </p>
          <button class="text-sm text-orange-600 font-medium absolute right-0 bottom-0 bg-white pl-1 read-more-btn hidden">
            Read more
          </button>
        </div>
      </div>
    </article>
    {% endfor %}
  </div>

  <!-- ============================= -->
  <!-- 4. Pagination (bottom numbers) -->
  <!-- ============================= -->
  <div class="mt-12 flex justify-center items-center space-x-2">
    <!-- Prev arrow -->
    <button class="px-3 py-1 rounded text-gray-500 hover:text-orange-600 disabled:opacity-40" disabled>
      ‹
    </button>
    <!-- Page numbers -->
    <button class="px-3 py-1 rounded bg-orange-500 text-white">1</button>
    <button class="px-3 py-1 rounded hover:bg-orange-100">2</button>
    <button class="px-3 py-1 rounded hover:bg-orange-100">3</button>
    <button class="px-3 py-1 rounded hover:bg-orange-100">4</button>
    <span class="px-2 text-gray-400">...</span>
    <button class="px-3 py-1 rounded hover:bg-orange-100">7</button>
    <!-- Next arrow -->
    <button class="px-3 py-1 rounded text-gray-500 hover:text-orange-600">
      ›
    </button>
  </div>
  <br><br>
</section>

<!-- ============================= -->
<!-- 5. Read More Logic (same smooth animation) -->
<!-- ============================= -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const reviews = document.querySelectorAll('.review-text');

    function setupReview(text) {
      const btn = text.parentElement.querySelector('.read-more-btn');
      const style = window.getComputedStyle(text);
      const lineHeight = parseFloat(style.lineHeight);
      const maxLines = window.innerWidth >= 1024 ? 2 : 3;
      const maxHeight = lineHeight * maxLines;

      // Show button if overflow
      if (text.scrollHeight > maxHeight + 2) {
        btn.classList.remove('hidden');
        text.style.maxHeight = maxHeight + 'px';
      }

      // Animate toggle
      btn.addEventListener('click', () => {
        const isCollapsed = text.style.maxHeight === maxHeight + 'px';
        if (isCollapsed) {
          text.style.maxHeight = text.scrollHeight + 'px';
          btn.textContent = 'Show less';
        } else {
          text.style.maxHeight = maxHeight + 'px';
          btn.textContent = 'Read more';
        }
      });

      text.style.transition = 'max-height 0.5s ease-in-out';
    }

    reviews.forEach(setupReview);

    // Handle resize for responsiveness
    window.addEventListener('resize', () => {
      reviews.forEach(text => {
        const btn = text.parentElement.querySelector('.read-more-btn');
        const style = window.getComputedStyle(text);
        const lineHeight = parseFloat(style.lineHeight);
        const maxLines = window.innerWidth >= 1024 ? 2 : 3;
        const maxHeight = lineHeight * maxLines;
        if (text.scrollHeight > maxHeight + 2) {
          btn.classList.remove('hidden');
          if (btn.textContent === 'Read more') text.style.maxHeight = maxHeight + 'px';
        } else {
          btn.classList.add('hidden');
          text.style.maxHeight = 'none';
        }
      });
    });
  });
</script>
{% endblock %}