{% extends "base.html" %}
{% load static %}

{% block title %}Your Wishlist | Kinbo Shop{% endblock %}
{% block footer %}{% endblock %}
{% block content %}
<section class="min-h-screen bg-orange-50 py-10 px-4">
  <div class="max-w-[1320px] mx-auto" style="padding-left: 16px;padding-right: 16px;">
    <h1 class="text-3xl font-semibold text-gray-800 text-center">Your Wishlist</h1>
    <!-- Header row -->
    <div class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-3">
        <input id="selectAll" type="checkbox" class="h-5 w-5 accent-orange-600">
        <label for="selectAll" class="text-gray-800 font-medium cursor-pointer">Select All</label>
      </div>
    </div>

    <!-- Items -->
    <div id="wishlistItems" class="space-y-6">

      <!-- ITEM: Demo 1 -->
      <div class="wl-item bg-white rounded-xl shadow overflow-hidden sm:flex sm:items-center transition-all duration-300 ease-in-out"
           data-id="w1" data-price="2500">
        <!-- Select checkbox -->
        <div class="p-4 sm:pl-5">
          <input type="checkbox" class="select-item h-5 w-5 accent-orange-600">
        </div>

        <!-- Image -->
        <div class="p-4">
          <img src="{% static 'images/product1.jpg' %}" alt="Wireless Headphones"
               class="w-full sm:w-40 h-48 sm:h-40 object-cover rounded-lg">
        </div>

        <!-- Info + actions -->
        <div class="p-5 flex-1">
          <div class="flex justify-between items-start flex-wrap gap-2">
            <div>
              <h2 class="text-lg font-semibold text-gray-800">Wireless Headphones</h2>
              <p class="text-sm text-gray-500">Color: Black</p>
            </div>
            <div class="text-right">
              <p class="text-sm text-gray-500">Price</p>
              <p class="text-lg font-semibold text-gray-800">‡ß≥ <span class="unit-price">2,500</span></p>
            </div>
          </div>

          <div class="mt-4 flex flex-wrap justify-between items-center gap-4 border-t border-gray-100 pt-4">
            <!-- Qty -->
            <div class="flex items-center gap-2">
              <button class="qty-btn border border-gray-300 rounded-md px-3 py-1 text-lg text-gray-700 hover:border-orange-500 hover:text-orange-600">‚àí</button>
              <input type="number" class="qty-input w-14 text-center border border-gray-200 rounded-md px-2 py-1 bg-gray-50" value="1" readonly />
              <button class="qty-btn border border-gray-300 rounded-md px-3 py-1 text-lg text-gray-700 hover:border-orange-500 hover:text-orange-600">+</button>
            </div>

            <!-- Actions -->
            <div class="flex items-center gap-3 sm:gap-6">
              <button class="add-to-cart-btn bg-orange-600 text-white px-4 py-2 rounded-md font-medium hover:scale-105 transition">
                Add to Cart
              </button>
              <button class="remove-btn flex items-center gap-2 text-red-600 hover:text-red-700 transition">
                <img src="{% static 'images/remove.png' %}" alt="Remove icon" class="w-4 h-4">
                <span class="text-sm font-medium">Remove from Wishlist</span>
              </button>
            </div>
          </div>

          <!-- Note toggle -->
          <div class="mt-3">
            <button class="toggle-note text-sm text-orange-600 hover:underline font-medium">üìù Add Note</button>
            <div class="note-wrap hidden mt-2">
              <textarea class="note-input w-full border border-gray-300 rounded-md p-2 text-sm focus:outline-none focus:ring-2 focus:ring-orange-300"
                        rows="2" placeholder="Add a note..."></textarea>
            </div>
          </div>
        </div>
      </div>

      <!-- ITEM: Demo 2 -->
      <div class="wl-item bg-white rounded-xl shadow overflow-hidden sm:flex sm:items-center transition-all duration-300 ease-in-out"
           data-id="w2" data-price="3000">
        <!-- Select checkbox -->
        <div class="p-4 sm:pl-5">
          <input type="checkbox" class="select-item h-5 w-5 accent-orange-600">
        </div>

        <!-- Image -->
        <div class="p-4">
          <img src="{% static 'images/product2.png' %}" alt="Smart Watch"
               class="w-full sm:w-40 h-48 sm:h-40 object-cover rounded-lg">
        </div>

        <!-- Info + actions -->
        <div class="p-5 flex-1">
          <div class="flex justify-between items-start flex-wrap gap-2">
            <div>
              <h2 class="text-lg font-semibold text-gray-800">Smart Watch</h2>
              <p class="text-sm text-gray-500">Size: 42mm</p>
            </div>
            <div class="text-right">
              <p class="text-sm text-gray-500">Price</p>
              <p class="text-lg font-semibold text-gray-800">‡ß≥ <span class="unit-price">3,000</span></p>
            </div>
          </div>

          <div class="mt-4 flex flex-wrap justify-between items-center gap-4 border-t border-gray-100 pt-4">
            <!-- Qty -->
            <div class="flex items-center gap-2">
              <button class="qty-btn border border-gray-300 rounded-md px-3 py-1 text-lg text-gray-700 hover:border-orange-500 hover:text-orange-600">‚àí</button>
              <input type="number" class="qty-input w-14 text-center border border-gray-200 rounded-md px-2 py-1 bg-gray-50" value="1" readonly />
              <button class="qty-btn border border-gray-300 rounded-md px-3 py-1 text-lg text-gray-700 hover:border-orange-500 hover:text-orange-600">+</button>
            </div>

            <!-- Actions -->
            <div class="flex items-center gap-3 sm:gap-6">
              <button class="add-to-cart-btn bg-orange-600 text-white px-4 py-2 rounded-md font-medium hover:scale-105 transition">
                Add to Cart
              </button>
              <button class="remove-btn flex items-center gap-2 text-red-600 hover:text-red-700 transition">
                <img src="{% static 'images/remove.png' %}" alt="Remove icon" class="w-4 h-4">
                <span class="text-sm font-medium">Remove from Wishlist</span>
              </button>
            </div>
          </div>

          <!-- Note toggle -->
          <div class="mt-3">
            <button class="toggle-note text-sm text-orange-600 hover:underline font-medium">üìù Add Note</button>
            <div class="note-wrap hidden mt-2">
              <textarea class="note-input w-full border border-gray-300 rounded-md p-2 text-sm focus:outline-none focus:ring-2 focus:ring-orange-300"
                        rows="2" placeholder="Add a note..."></textarea>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- Empty state -->
    <div id="emptyState" class="hidden flex flex-col items-center justify-center py-24 text-gray-700">
      <p class="text-xl font-medium mb-6 text-center px-4">Your wishlist is empty ‚Äî start exploring and save what you love ‚ù§Ô∏è</p>
      <a href="/shop/" class="bg-orange-600 text-white px-6 py-3 rounded-lg font-semibold hover:scale-105 transition">
        Shop Now
      </a>
    </div>
  </div>

  <!-- Sticky bulk action bar (appears only when any items are selected) -->
  <div id="bulkBar" class="fixed left-0 right-0 bottom-4 z-40 pointer-events-none">
    <div class="max-w-[1320px] mx-auto px-4">
        <div class="bulk-inner hidden pointer-events-auto bg-white shadow-lg border border-gray-200 rounded-xl p-3 flex items-center justify-between">
            <p class="text-sm text-gray-700"><span id="selectedCount" class="font-semibold text-gray-900">0</span> selected</p>
            <div class="flex items-center gap-2">
                <button id="bulkAddToCart" class="flex items-center gap-2 bg-orange-600 text-white px-4 py-2 rounded-md font-medium hover:scale-105 transition">
                    <img src="{% static 'images/cart.png' %}" alt="Cart icon" class="w-4 h-4">
                    <span>Add Selected to Cart</span>
                </button>
                <button id="bulkRemove" class="flex items-center gap-2 text-red-600 border border-red-200 px-4 py-2 rounded-md font-medium hover:bg-red-50 transition">
                    <img src="{% static 'images/remove.png' %}" alt="Remove icon" class="w-4 h-4">
                    <span>Remove Selected</span>
                </button>
            </div>
        </div>
    </div>
  </div>
</section>

<style>
  /* Subtle remove animation (mirrors your cart page feel) */
  @keyframes fadeSlideOut {
    0% { opacity: 1; transform: translateY(0); }
    100% { opacity: 0; transform: translateY(20px); }
  }
  .fade-out { animation: fadeSlideOut 0.3s ease forwards; }
</style>

<!-- JS -->
<script>
  // ---- Utilities
  const $ = (sel, ctx = document) => ctx.querySelector(sel);
  const $$ = (sel, ctx = document) => Array.from(ctx.querySelectorAll(sel));
  const toInt = (v) => parseInt(v) || 0;

  // ---- DOM refs
  const container = $('#wishlistItems');
  const emptyState = $('#emptyState');
  const selectAll = $('#selectAll');
  const bulkBar = $('#bulkBar .bulk-inner');
  const selectedCountEl = $('#selectedCount');
  const bulkAddToCartBtn = $('#bulkAddToCart');
  const bulkRemoveBtn = $('#bulkRemove');

  // ---- Helpers
  function refreshSelectionUI() {
    // Count selected items and toggle bulk bar visibility
    const selected = $$('.select-item:checked');
    selectedCountEl.textContent = selected.length;
    if (selected.length > 0) {
      bulkBar.classList.remove('hidden');
    } else {
      bulkBar.classList.add('hidden');
    }

    // Update Select All state
    const all = $$('.select-item');
    selectAll.checked = (all.length > 0) && (selected.length === all.length);
    selectAll.indeterminate = (selected.length > 0 && selected.length < all.length);
  }

  function refreshEmptyState() {
  const items = $$('.wl-item');
  const selectAllRow = selectAll.closest('div'); // parent div for the "Select All" row
  if (items.length === 0) {
    container.classList.add('hidden');
    emptyState.classList.remove('hidden');
    // hide select all when empty
    if (selectAllRow) selectAllRow.classList.add('hidden');
  } else {
    container.classList.remove('hidden');
    emptyState.classList.add('hidden');
    // show select all when not empty
    if (selectAllRow) selectAllRow.classList.remove('hidden');
  }
}


  // ---- Setup per-item controls
  function bindItem(item) {
    const qtyBtns = $$('.qty-btn', item);
    const qtyInput = $('.qty-input', item);
    const removeBtn = $('.remove-btn', item);
    const selectCb = $('.select-item', item);
    const addToCartBtn = $('.add-to-cart-btn', item);
    const toggleNoteBtn = $('.toggle-note', item);
    const noteWrap = $('.note-wrap', item);

    // Quantity increment/decrement (front-end only)
    qtyBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        let val = toInt(qtyInput.value);
        if (btn.textContent.trim() === '+') val++;
        else if (val > 1) val--;
        qtyInput.value = val;
      });
    });

    // Remove single item with fade-out
    removeBtn.addEventListener('click', () => {
      item.classList.add('fade-out');
      setTimeout(() => {
        item.remove();
        refreshSelectionUI();
        refreshEmptyState();
      }, 300);
    });

    // Select checkbox -> update bulk bar
    selectCb.addEventListener('change', refreshSelectionUI);

    // Simulated "Add to Cart" action (front-end only)
    addToCartBtn.addEventListener('click', () => {
      // You can hook this to your cart logic later
      addToast('Added to cart.');
    });

    // Toggle note field
    toggleNoteBtn.addEventListener('click', () => {
      noteWrap.classList.toggle('hidden');
    });
  }

  // ---- Toast (tiny helper)
  let toastTimeout;
  function addToast(msg) {
    let toast = document.getElementById('toast');
    if (!toast) {
      toast = document.createElement('div');
      toast.id = 'toast';
      toast.className = 'fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-gray-900 text-white text-sm px-4 py-2 rounded-md shadow';
      document.body.appendChild(toast);
    }
    toast.textContent = msg;
    toast.style.opacity = '1';
    clearTimeout(toastTimeout);
    toastTimeout = setTimeout(() => { toast.style.opacity = '0'; }, 1400);
  }

  // ---- Bulk actions
  function getSelectedItems() {
    return $$('.wl-item').filter(item => $('.select-item', item).checked);
  }

  bulkAddToCartBtn.addEventListener('click', () => {
    const selected = getSelectedItems();
    if (selected.length === 0) return;
    // Simulate add to cart for each selected item (front-end only)
    addToast(`${selected.length} item(s) added to cart.`);
    // (Optional) Keep them in wishlist, or uncheck them:
    selected.forEach(item => $('.select-item', item).checked = false);
    refreshSelectionUI();
  });

  bulkRemoveBtn.addEventListener('click', () => {
    const selected = getSelectedItems();
    if (selected.length === 0) return;
    selected.forEach(item => {
      item.classList.add('fade-out');
      setTimeout(() => item.remove(), 300);
    });
    setTimeout(() => {
      refreshSelectionUI();
      refreshEmptyState();
    }, 320);
  });

  // ---- Select All
  selectAll.addEventListener('change', () => {
    const all = $$('.select-item');
    all.forEach(cb => cb.checked = selectAll.checked);
    refreshSelectionUI();
  });

  // ---- Init
  document.addEventListener('DOMContentLoaded', () => {
    // Bind all current items
    $$('.wl-item').forEach(bindItem);
    refreshSelectionUI();
    refreshEmptyState();
  });
</script>
{% endblock %}