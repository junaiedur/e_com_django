{% extends "base.html" %}
{% load static %}

{% block title %}Your Cart | Kinbo Shop{% endblock %}
{% block footer %}{% endblock %}

{% block content %}
<section class="min-h-screen bg-orange-50 py-10 px-4">
  <div class="max-w-[1320px] mx-auto flex flex-col lg:flex-row items-start gap-10" style="padding-left: 16px;padding-right: 16px;">

    <!-- Left: Cart Section -->
    <div id="cartColumn" class="flex-1 w-full lg:w-2/3 relative flex flex-col">
      <!-- Header -->
      <div id="cartHeader" class="mb-6">
        <h1 class="text-3xl font-semibold text-gray-800">
          Your Cart (<span id="itemCount">0</span> items)
        </h1>
      </div>

      <!-- Items container -->
      <div id="itemsContainer" class="space-y-6">

        <!-- Example Item -->
        <div class="cart-item bg-white rounded-xl shadow overflow-hidden sm:flex sm:items-center transition-all duration-300 ease-in-out" data-id="1" data-price="2500">
          <div class="p-4">
            <img src="{% static 'images/product1.png' %}" alt="Wireless Headphones"
                 class="w-full sm:w-40 h-48 sm:h-40 object-cover rounded-lg">
          </div>
          <div class="p-5 flex-1 flex flex-col justify-between">
            <div class="flex justify-between items-start flex-wrap gap-2">
              <div>
                <h2 class="text-lg font-semibold text-gray-800">Wireless Headphones</h2>
                <p class="text-sm text-gray-500">Color: Black</p>
              </div>
              <div class="text-right">
                <p class="text-sm text-gray-500">Unit Price</p>
                <p class="text-lg font-semibold text-gray-800">‡ß≥ <span class="unit-price">2,500</span></p>
              </div>
            </div>

            <div class="mt-4 flex flex-wrap justify-between items-center gap-4 border-t border-gray-100 pt-4">
              <div class="flex items-center gap-2">
                <button class="qty-btn border border-gray-300 rounded-md px-3 py-1 text-lg text-gray-700 hover:border-orange-500 hover:text-orange-600">‚àí</button>
                <input type="number" class="qty-input w-14 text-center border border-gray-200 rounded-md px-2 py-1 bg-gray-50" value="1" readonly />
                <button class="qty-btn border border-gray-300 rounded-md px-3 py-1 text-lg text-gray-700 hover:border-orange-500 hover:text-orange-600">+</button>
              </div>
              <div class="flex items-center gap-8">
                <div class="text-right">
                  <p class="text-sm text-gray-500">Item Total</p>
                  <p class="text-lg font-semibold text-gray-800">‡ß≥ <span class="item-total">2,500</span></p>
                </div>
                <button class="remove-btn flex items-center gap-2 text-red-600 hover:text-red-700 transition">
                  <img src="{% static 'images/remove.png' %}" alt="Remove icon" class="w-4 h-4">
                  <span class="text-sm font-medium">Remove</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Example Item 2 -->
        <div class="cart-item bg-white rounded-xl shadow overflow-hidden sm:flex sm:items-center transition-all duration-300 ease-in-out" data-id="2" data-price="3000">
          <div class="p-4">
            <img src="{% static 'images/product2.png' %}" alt="Smart Watch"
                 class="w-full sm:w-40 h-48 sm:h-40 object-cover rounded-lg">
          </div>
          <div class="p-5 flex-1 flex flex-col justify-between">
            <div class="flex justify-between items-start flex-wrap gap-2">
              <div>
                <h2 class="text-lg font-semibold text-gray-800">Smart Watch</h2>
                <p class="text-sm text-gray-500">Size: 42mm</p>
              </div>
              <div class="text-right">
                <p class="text-sm text-gray-500">Unit Price</p>
                <p class="text-lg font-semibold text-gray-800">‡ß≥ <span class="unit-price">3,000</span></p>
              </div>
            </div>

            <div class="mt-4 flex flex-wrap justify-between items-center gap-4 border-t border-gray-100 pt-4">
              <div class="flex items-center gap-2">
                <button class="qty-btn border border-gray-300 rounded-md px-3 py-1 text-lg text-gray-700 hover:border-orange-500 hover:text-orange-600">‚àí</button>
                <input type="number" class="qty-input w-14 text-center border border-gray-200 rounded-md px-2 py-1 bg-gray-50" value="1" readonly />
                <button class="qty-btn border border-gray-300 rounded-md px-3 py-1 text-lg text-gray-700 hover:border-orange-500 hover:text-orange-600">+</button>
              </div>
              <div class="flex items-center gap-8">
                <div class="text-right">
                  <p class="text-sm text-gray-500">Item Total</p>
                  <p class="text-lg font-semibold text-gray-800">‡ß≥ <span class="item-total">3,000</span></p>
                </div>
                <button class="remove-btn flex items-center gap-2 text-red-600 hover:text-red-700 transition">
                  <img src="{% static 'images/remove.png' %}" alt="Remove icon" class="w-4 h-4">
                  <span class="text-sm font-medium">Remove</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty cart message -->
      <div id="emptyMessage" class="hidden absolute inset-0 flex flex-col items-center justify-center text-gray-700">
        <p class="text-xl font-medium mb-6 text-center px-4">Your cart is empty ‚Äî items you add will appear here! üõçÔ∏è</p>
        <a href="/shop/" class="bg-orange-600 text-white px-6 py-3 rounded-lg font-semibold hover:scale-105 transition">
          Continue Shopping
        </a>
      </div>
    </div>

    <!-- Right: Summary Section -->
    <aside id="summarySection" class="lg:w-1/3 w-full sticky top-0 self-start">
      <div class="bg-white rounded-xl shadow p-6 space-y-6">
        <div>
          <h3 class="text-lg font-semibold text-gray-800">Delivery</h3>
          <div class="mt-3 space-y-2">
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="radio" name="delivery" value="standard" checked class="accent-orange-500">
              <div>
                <div class="font-medium text-gray-800">Standard (3‚Äì5 days)</div>
                <div class="text-sm text-gray-500">‡ß≥ <span id="deliveryCostStandard">50</span></div>
              </div>
            </label>
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="radio" name="delivery" value="express" class="accent-orange-500">
              <div>
                <div class="font-medium text-gray-800">Express (1‚Äì2 days)</div>
                <div class="text-sm text-gray-500">‡ß≥ <span id="deliveryCostExpress">100</span></div>
              </div>
            </label>
          </div>
        </div>

        <!-- Promo Code -->
        <div>
          <h3 class="text-lg font-semibold text-gray-800">Promo Code</h3>
          <div class="mt-3 flex gap-2">
            <input id="promoInput" type="text" placeholder="Enter promo code"
                   class="flex-1 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-300">
            <button id="applyPromoBtn" class="bg-orange-500 text-white px-4 py-2 rounded-md hover:scale-105 transition">Apply</button>
          </div>
          <p id="promoMessage" class="mt-2 text-sm hidden"></p>
        </div>

        <!-- Totals -->
        <div>
          <div class="flex justify-between text-gray-700">
            <span>Subtotal</span><span>‡ß≥ <span id="subtotal">0</span></span>
          </div>
          <div class="flex justify-between text-gray-700 mt-1">
            <span>Delivery</span><span>‡ß≥ <span id="selectedDeliveryCost">50</span></span>
          </div>
          <div class="flex justify-between text-gray-700 mt-1">
            <span>Discount</span><span>‡ß≥ <span id="discountAmount">0</span></span>
          </div>
          <div class="border-t border-gray-200 my-3"></div>
          <div class="flex justify-between text-lg font-semibold text-gray-900">
            <span>Grand Total</span><span>‡ß≥ <span id="grandTotal">0</span></span>
          </div>
          <div class="mt-3 text-sm text-gray-600">
            <span>Estimated delivery:</span>
            <span id="estimatedRange" class="font-medium text-gray-800">3‚Äì5 days</span>
          </div>
        </div>

        <!-- Checkout -->
        <div class="space-y-3">
          <button id="checkoutBtn"
                  class="w-full bg-orange-600 text-white py-3 rounded-lg font-semibold hover:scale-105 transition">
            Proceed to Checkout
          </button>
          <a href="/shop/" class="block text-center text-orange-600 hover:underline font-medium">‚Üê Continue Shopping</a>
        </div>
      </div>
    </aside>
  </div>
</section>

<style>
  #emptyMessage {
    margin-top: 200px;
    padding-top: 20px;
    padding-bottom: 50px;
    opacity: 0;
    transform: translateY(30px);
    transition: opacity 0.4s ease, transform 0.4s ease;
  }

  #emptyMessage.show {
    opacity: 1;
    transform: translateY(0);
  }


  /* Subtle remove animation */
  @keyframes fadeSlideOut {
    0% { opacity: 1; transform: translateY(0); }
    100% { opacity: 0; transform: translateY(20px); }
  }

  .fade-out {
    animation: fadeSlideOut 0.3s ease forwards;
  }
  
  @media (max-width: 1024px) {
    @keyframes fadeSlideDown {
      0% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(25px); }
    }
    .fade-out {
      animation: fadeSlideDown 0.35s ease-out forwards;
    }
  }
</style>

<!-- JS -->
<script>
  const toInt = (v) => parseInt(v) || 0;
  const cartHeader = document.getElementById('cartHeader');
  const itemsContainer = document.getElementById('itemsContainer');
  const emptyMessage = document.getElementById('emptyMessage');
  const itemCountEl = document.getElementById('itemCount');
  const subtotalEl = document.getElementById('subtotal');
  const grandTotalEl = document.getElementById('grandTotal');
  const discountAmountEl = document.getElementById('discountAmount');
  const selectedDeliveryCostEl = document.getElementById('selectedDeliveryCost');
  const estimatedRangeEl = document.getElementById('estimatedRange');
  const deliveryRadios = document.querySelectorAll('input[name="delivery"]');
  const promoInput = document.getElementById('promoInput');
  const promoMessage = document.getElementById('promoMessage');
  const applyPromoBtn = document.getElementById('applyPromoBtn');

  const DELIVERY_COSTS = { standard: 50, express: 100 };
  let promo = { applied: false, amount: 0 };

  function updateTotals() {
    const items = document.querySelectorAll('.cart-item');
    let subtotal = 0, totalItems = 0;

    items.forEach(card => {
      const price = toInt(card.dataset.price);
      const qty = toInt(card.querySelector('.qty-input').value);
      const total = price * qty;
      card.querySelector('.item-total').textContent = total.toLocaleString();
      subtotal += total;
      totalItems += qty;
    });

    itemCountEl.textContent = totalItems;
    subtotalEl.textContent = subtotal.toLocaleString();

    const deliveryType = document.querySelector('input[name="delivery"]:checked').value;
    const deliveryCost = DELIVERY_COSTS[deliveryType];
    selectedDeliveryCostEl.textContent = deliveryCost.toLocaleString();

    const discount = promo.applied ? promo.amount : 0;
    discountAmountEl.textContent = discount.toLocaleString();

    const grand = subtotal + deliveryCost - discount;
    grandTotalEl.textContent = grand.toLocaleString();

    estimatedRangeEl.textContent = deliveryType === 'express' ? '1‚Äì2 days' : '3‚Äì5 days';

    if (items.length === 0) {
      itemsContainer.classList.add('hidden');
      cartHeader.classList.add('hidden');
      emptyMessage.classList.remove('hidden');
        setTimeout(() => {
          emptyMessage.classList.add('show');
  }, 100);
    } else {
      itemsContainer.classList.remove('hidden');
      cartHeader.classList.remove('hidden');
      emptyMessage.classList.add('hidden');
    }
  }

  function setupQtyButtons() {
    document.querySelectorAll('.qty-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const card = btn.closest('.cart-item');
        const input = card.querySelector('.qty-input');
        let val = toInt(input.value);
        if (btn.textContent.trim() === '+') val++;
        else if (val > 1) val--;
        input.value = val;
        updateTotals();
      });
    });
  }

  function setupRemoveButtons() {
    document.querySelectorAll('.remove-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const card = btn.closest('.cart-item');
        card.classList.add('fade-out');
        setTimeout(() => {
          card.remove();
          updateTotals();
        }, 300); // matches CSS animation duration
      });
    });
  }

  function setupDeliveryChange() {
    deliveryRadios.forEach(radio => radio.addEventListener('change', updateTotals));
  }

  function setupPromoCode() {
    applyPromoBtn.addEventListener('click', (e) => {
      e.preventDefault();
      const code = promoInput.value.trim();
      if (!code) {
        promoMessage.textContent = 'Please enter a promo code.';
        promoMessage.className = 'mt-2 text-sm text-red-600';
        return;
      }
      promo.applied = true;
      promo.amount = 200;
      promoMessage.textContent = '‚úÖ Promo applied: ‡ß≥200 discount';
      promoMessage.className = 'mt-2 text-sm text-green-600';
      updateTotals();
    });
  }

  document.addEventListener('DOMContentLoaded', () => {
    setupQtyButtons();
    setupRemoveButtons();
    setupDeliveryChange();
    setupPromoCode();
    updateTotals();
  });
</script>
{% endblock %}