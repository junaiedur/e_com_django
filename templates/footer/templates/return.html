{% extends 'base.html' %}
{% load static %}

{% block title %}Returns | Kinbo Shop{% endblock %}

{% block category %}{% endblock %}

{% block content %}
<div class="min-h-screen bg-orange-50 py-10">
  <div class="max-w-[1320px] mx-auto px-4 space-y-6" style="padding-left: 0px;padding-right: 0px;">

    <h1 class="text-3xl font-bold text-orange-600 text-center">
      Product Returns
    </h1>

    <div class="bg-white rounded-xl shadow p-6">

      <!-- TABS -->
      <div class="border-b mb-4 overflow-x-auto">
        <div class="flex gap-4 min-w-max">
          <button
            class="py-2 px-3 border-b-2 border-orange-600 text-orange-600 font-semibold text-sm"
            data-return-tab="request"
          >
            Request Return
          </button>

          <button
            class="py-2 px-3 border-b-2 border-transparent text-gray-600 hover:text-orange-600 text-sm"
            data-return-tab="history"
          >
            Return History
          </button>
        </div>
      </div>

      <!-- TAB CONTENT 1 -->
      <div id="requestTab" data-return-content class="space-y-4">
        <form id="returnForm" class="space-y-4" enctype="multipart/form-data">

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Order Number
            </label>
            <input
              type="text"
              required
              id="orderNumber"
              placeholder="Enter your order number"
              class="w-full px-4 py-2 border rounded focus:border-orange-500 focus:ring focus:ring-orange-200 outline-none text-gray-800"
            >
            <p class="hidden text-red-600 text-sm">
              Order number is required
            </p>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Reason for Return
            </label>

            <select
              id="returnReason"
              required
              class="w-full px-4 py-2 border rounded focus:border-orange-500 focus:ring focus:ring-orange-200 outline-none text-gray-800"
            >
              <option value="">Select a reason</option>
              <option>Wrong Size</option>
              <option>Wrong Item Received</option>
              <option>Damaged Product</option>
              <option>Not as Described</option>
              <option>Quality Issue</option>
              <option value="other">Other</option>
            </select>
            <p class="hidden text-red-600 text-sm">
              Reason is required
            </p>

            <input
              id="customReason"
              type="text"
              placeholder="Please specify your reason"
              class="hidden mt-2 w-full px-4 py-2 border rounded focus:border-orange-500 focus:ring focus:ring-orange-200 outline-none text-gray-800"
            >
            <p id="customReasonError" class="hidden text-red-600 text-sm mt-1">
              Please enter your custom reason
            </p>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Additional Notes (Optional)
            </label>
            <textarea
              id="notes"
              rows="3"
              class="w-full px-4 py-2 border rounded focus:border-orange-500 focus:ring focus:ring-orange-200 outline-none text-gray-800"
              placeholder="Write your notes..."
            ></textarea>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Upload Image (required)
            </label>
            <input
              type="file"
              id="imageUpload"
              required
              accept="image/*"
              class="w-full px-2 py-2 border rounded focus:border-orange-500 focus:ring focus:ring-orange-200 outline-none text-gray-800"
            >
            <p class="hidden text-red-600 text-sm">
              Please upload an image
            </p>
          </div>

          <button
            type="submit"
            class="w-full sm:w-auto bg-orange-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-orange-700 transition"
          >
            Submit Return Request
          </button>
        </form>
      </div>

      <!-- TAB CONTENT 2 -->
      <div id="historyTab" data-return-content class="hidden space-y-4">
        <h2 class="text-lg font-semibold text-gray-900">Your Return History</h2>

        <div class="bg-white border rounded-xl p-4 shadow-sm">
          <div class="flex justify-between items-center mb-2">
            <h3 class="font-semibold text-gray-900">Return #R987654</h3>
            <span class="text-sm text-green-600 font-medium">Refunded</span>
          </div>

          <p class="text-sm text-gray-700">Order Number: 987654</p>
          <p class="text-sm text-gray-700">Reason: Damaged Product</p>
          <p class="text-sm text-gray-700">Price Refunded: ৳900</p>
          <p class="text-sm text-gray-700">Requested On: Jan 15, 2025</p>
          <p class="text-sm text-gray-700">Refunded On: Jan 18, 2025</p>

          <div class="mt-4 flex flex-wrap gap-3">
            <button
              class="px-4 py-2 bg-orange-100 text-orange-700 rounded-lg text-sm hover:bg-orange-200 transition"
              data-return-track="R987654"
            >
              Track Return
            </button>

            <button
              class="px-4 py-2 bg-gray-100 text-gray-800 rounded-lg text-sm hover:bg-gray-200 transition"
              id="contactSupportBtn"
            >
              Contact Support
            </button>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- RETURN TRACK MODAL -->
<div
  id="returnTrackModal"
  class="hidden fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center p-4 z-50"
>
  <div class="bg-white rounded-xl shadow-xl max-w-md w-full p-6 relative">
    <h2 class="text-xl font-bold text-orange-600 mb-4">Return Status</h2>

    <p id="returnModalNumber" class="text-sm text-gray-700 mb-4"></p>

    <div class="space-y-3 text-sm">
      <p class="flex items-center gap-2"><span class="text-green-600">✔</span> Return Requested</p>
      <p class="flex items-center gap-2"><span class="text-green-600">✔</span> Approved</p>
      <p class="flex items-center gap-2"><span class="text-yellow-600">⏳</span> Pickup Scheduled</p>
      <p class="flex items-center gap-2"><span class="text-gray-600">□</span> Refund Processed</p>
    </div>

    <button
      id="closeReturnTrackModal"
      class="mt-6 w-full bg-gray-100 text-gray-800 py-2 rounded-lg hover:bg-gray-200 transition"
    >
      Close
    </button>
  </div>
</div>

<script>
/* ============================================================
   FIXED TAB LOGIC (Underline + Active Tab)
   ============================================================ */
const rtabBtns = document.querySelectorAll('[data-return-tab]');
const rtabContents = document.querySelectorAll('[data-return-content]');

rtabBtns.forEach(btn => {
  btn.addEventListener('click', () => {

    // Reset all tab states
    rtabBtns.forEach(b => {
      b.classList.remove(
        'border-orange-600',
        'text-orange-600',
        'font-semibold'
      );
      b.classList.add(
        'border-transparent',
        'text-gray-600'
      );
    });

    // Activate clicked tab
    btn.classList.remove('border-transparent', 'text-gray-600');
    btn.classList.add(
      'border-orange-600',
      'text-orange-600',
      'font-semibold'
    );

    // Show content
    const target = btn.getAttribute('data-return-tab');
    rtabContents.forEach(tab => tab.classList.add('hidden'));
    document.getElementById(target + 'Tab').classList.remove('hidden');
  });
});

/* ============================================================
   MODAL + FORM LOGIC (unchanged)
   ============================================================ */
const trackBtns = document.querySelectorAll('[data-return-track]');
const returnModal = document.getElementById('returnTrackModal');
const closeReturnModal = document.getElementById('closeReturnTrackModal');
const returnModalNumber = document.getElementById('returnModalNumber');

trackBtns.forEach(btn => {
  btn.addEventListener('click', () => {
    const id = btn.getAttribute('data-return-track');
    returnModalNumber.textContent = 'Return ID: ' + id;
    returnModal.classList.remove('hidden');
  });
});

closeReturnModal.addEventListener('click', () => {
  returnModal.classList.add('hidden');
});

const contactSupportBtn = document.getElementById('contactSupportBtn');
if (contactSupportBtn) {
  contactSupportBtn.addEventListener('click', () => {
    alert('Contact support placeholder.');
  });
}

const rForm = document.getElementById('returnForm');
const reasonSelect = document.getElementById('returnReason');
const customReason = document.getElementById('customReason');
const customReasonError = document.getElementById('customReasonError');

reasonSelect.addEventListener('change', () => {
  if (reasonSelect.value === 'other') {
    customReason.classList.remove('hidden');
  } else {
    customReason.classList.add('hidden');
    customReason.value = '';
    customReasonError.classList.add('hidden');
  }
});

rForm.addEventListener('submit', e => {
  e.preventDefault();

  let valid = true;

  const orderNo = document.getElementById('orderNumber');
  const reason = document.getElementById('returnReason');
  const image = document.getElementById('imageUpload');

  if (!orderNo.value.trim()) {
    orderNo.classList.add('border-red-500');
    orderNo.nextElementSibling.classList.remove('hidden');
    valid = false;
  } else {
    orderNo.classList.remove('border-red-500');
    orderNo.nextElementSibling.classList.add('hidden');
  }

  if (!reason.value.trim()) {
    reason.classList.add('border-red-500');
    reason.nextElementSibling.classList.remove('hidden');
    valid = false;
  } else {
    reason.classList.remove('border-red-500');
    reason.nextElementSibling.classList.add('hidden');
  }

  if (reason.value === 'other' && !customReason.value.trim()) {
    customReason.classList.add('border-red-500');
    customReasonError.classList.remove('hidden');
    valid = false;
  } else {
    customReason.classList.remove('border-red-500');
    customReasonError.classList.add('hidden');
  }

  if (!image.files.length) {
    image.classList.add('border-red-500');
    image.nextElementSibling.classList.remove('hidden');
    valid = false;
  } else {
    image.classList.remove('border-red-500');
    image.nextElementSibling.classList.add('hidden');
  }

  if (valid) {
    alert('Return request submitted successfully!');
    rForm.reset();
    customReason.classList.add('hidden');
    customReasonError.classList.add('hidden');
  }
});
</script>

{% endblock %}
{% block footer %}{% endblock %}
